// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "sqlite"
    url      = env("DATABASE_URL")
}

model User {
    id        String         @id @default(cuid())
    clerkId   String         @unique
    name      String
    role      String         @default("user")
    posts     Post[]         @relation("AuthorPosts")
    bookmarks Bookmark[]
    likes     Like[]
    profile   AuthorProfile?
}

model AuthorProfile {
    id            String  @id @default(cuid())
    name          String  @unique
    bio           String?
    twitterLink   String?
    instagramLink String?
    linkedinLink  String?
    user          User    @relation(fields: [userId], references: [id])
    userId        String  @unique
    posts         Post[]  @relation("AuthorProfilePosts")
}

model Post {
    id        String         @id @default(cuid())
    title     String
    slug      String         @unique
    excerpt   String?
    content   String
    published Boolean        @default(false)
    createdAt DateTime       @default(now())
    updatedAt DateTime       @updatedAt
    author    User           @relation("AuthorPosts", fields: [authorId], references: [id])
    authorId  String
    profile   AuthorProfile? @relation("AuthorProfilePosts", fields: [profileId], references: [id])
    profileId String?
    tags      PostTag[]
    likes     Like[]
    bookmarks Bookmark[]
}

model Tag {
    id      String    @id @default(cuid())
    tagName String    @unique
    posts   PostTag[]
}

model PostTag {
    id     String @id @default(cuid())
    post   Post   @relation(fields: [postId], references: [id])
    postId String
    tag    Tag    @relation(fields: [tagId], references: [id])
    tagId  String

    @@unique([postId, tagId]) // Prevent duplicate tags on same post
}

model Like {
    id     String @id @default(cuid())
    user   User   @relation(fields: [userId], references: [id])
    userId String
    post   Post   @relation(fields: [postId], references: [id])
    postId String

    @@unique([userId, postId]) // Only one like per user per post
}

model Bookmark {
    id     String @id @default(cuid())
    user   User   @relation(fields: [userId], references: [id])
    userId String
    post   Post   @relation(fields: [postId], references: [id])
    postId String

    @@unique([userId, postId]) // Only one bookmark per user per post
}
